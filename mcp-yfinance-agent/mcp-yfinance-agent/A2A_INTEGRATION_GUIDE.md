# A2A (AI-to-AI) ì—°ë™ ê°€ì´ë“œ

## ğŸ“‹ ê°œìš”

ì´ ë¬¸ì„œëŠ” ë‹¤ë¥¸ AI ì—ì´ì „íŠ¸ë“¤ì´ ìš°ë¦¬ì˜ íˆ¬ì ë¶„ì„ ì‹œìŠ¤í…œê³¼ A2A(AI-to-AI) í†µì‹ ì„ í†µí•´ ì—°ë™í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ê°€ì´ë“œì…ë‹ˆë‹¤.

## ğŸ—ï¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ì™¸ë¶€ AI       â”‚    â”‚   ì™¸ë¶€ AI       â”‚    â”‚   ì™¸ë¶€ AI       â”‚
â”‚   ì—ì´ì „íŠ¸ A    â”‚    â”‚   ì—ì´ì „íŠ¸ B    â”‚    â”‚   ì—ì´ì „íŠ¸ C    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                      â”‚                      â”‚
          â”‚     A2A Protocol     â”‚                      â”‚
          â”‚     (WebSocket/HTTP) â”‚                      â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚         â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚      A2A Integration          â”‚
            â”‚         Manager               â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚    Specialized Adapters       â”‚
            â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”â”‚
            â”‚  â”‚Investmentâ”‚  Risk   â”‚Portfolioâ”‚
            â”‚  â”‚ Adapter  â”‚ Adapter â”‚Adapter â”‚â”‚
            â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚     Core AI Agents            â”‚
            â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”â”‚
            â”‚  â”‚Investmentâ”‚  Risk   â”‚Portfolioâ”‚
            â”‚  â”‚  Agent   â”‚ Agent   â”‚ Agent â”‚â”‚
            â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1. ì„œë²„ ì—°ê²°

ìš°ë¦¬ ì‹œìŠ¤í…œì— ì—°ê²°í•˜ë ¤ë©´ ë‹¤ìŒ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”:

```python
# WebSocket ì—°ê²°
WEBSOCKET_ENDPOINTS = {
    "investment": "ws://localhost:8766",
    "risk": "ws://localhost:8767", 
    "portfolio": "ws://localhost:8768"
}

# HTTP API ì—°ê²°
HTTP_ENDPOINT = "http://localhost:8000/a2a"
```

### 2. ê¸°ë³¸ ì—°ê²° ì˜ˆì œ

```python
import asyncio
import websockets
import json

async def connect_to_investment_agent():
    """íˆ¬ì ë¶„ì„ ì—ì´ì „íŠ¸ì— ì—°ê²°"""
    uri = "ws://localhost:8766"
    
    async with websockets.connect(uri) as websocket:
        # ì—°ê²° í™•ì¸
        print("íˆ¬ì ë¶„ì„ ì—ì´ì „íŠ¸ì— ì—°ê²°ë¨")
        
        # ìˆ˜ì‹  ëŒ€ê¸°
        async for message in websocket:
            data = json.loads(message)
            print(f"ìˆ˜ì‹ : {data}")
            break

# ì—°ê²° ì‹¤í–‰
asyncio.run(connect_to_investment_agent())
```

## ğŸ“¡ A2A í”„ë¡œí† ì½œ

### ë©”ì‹œì§€ êµ¬ì¡°

```json
{
  "message_id": "msg_1703123456_001",
  "sender_id": "your_agent_id",
  "receiver_id": "investment_agent_001",
  "message_type": "request",
  "priority": "high",
  "timestamp": "2024-12-21T10:30:00Z",
  "payload": {
    "ticker": "AAPL",
    "analysis_type": "comprehensive",
    "timeframe": "1m",
    "user_profile": {
      "risk_tolerance": "moderate",
      "investment_horizon": "short_term"
    }
  },
  "correlation_id": null,
  "expires_at": "2024-12-21T10:35:00Z"
}
```

### ë©”ì‹œì§€ íƒ€ì…

| íƒ€ì… | ì„¤ëª… | ì‚¬ìš© ì˜ˆì‹œ |
|------|------|-----------|
| `request` | ë¶„ì„ ìš”ì²­ | ì£¼ì‹ ë¶„ì„, í¬íŠ¸í´ë¦¬ì˜¤ ë¶„ì„ |
| `response` | ë¶„ì„ ì‘ë‹µ | ë¶„ì„ ê²°ê³¼ ë°˜í™˜ |
| `error` | ì—ëŸ¬ ì‘ë‹µ | ì²˜ë¦¬ ì‹¤íŒ¨ ì‹œ |
| `heartbeat` | ì—°ê²° ìƒíƒœ í™•ì¸ | ì£¼ê¸°ì  ì—°ê²° í™•ì¸ |
| `registration` | ì—ì´ì „íŠ¸ ë“±ë¡ | ìƒˆë¡œìš´ ì—ì´ì „íŠ¸ ë“±ë¡ |

## ğŸ”§ API ì‚¬ìš©ë²•

### 1. ì£¼ì‹ ë¶„ì„ ìš”ì²­

```python
async def request_stock_analysis(ticker: str, analysis_type: str = "comprehensive"):
    """ì£¼ì‹ ë¶„ì„ ìš”ì²­"""
    
    message = {
        "message_id": f"msg_{int(time.time())}",
        "sender_id": "your_agent_id",
        "receiver_id": "investment_agent_001",
        "message_type": "request",
        "priority": "high",
        "timestamp": datetime.now().isoformat(),
        "payload": {
            "ticker": ticker,
            "analysis_type": analysis_type,  # "technical", "fundamental", "comprehensive"
            "timeframe": "1m",  # "1d", "1w", "1m", "3m", "1y"
            "user_profile": {
                "risk_tolerance": "moderate",
                "investment_horizon": "short_term",
                "trading_style": "swing_trading"
            }
        }
    }
    
    # WebSocketìœ¼ë¡œ ì „ì†¡
    async with websockets.connect("ws://localhost:8766") as websocket:
        await websocket.send(json.dumps(message))
        
        # ì‘ë‹µ ìˆ˜ì‹ 
        response = await websocket.recv()
        result = json.loads(response)
        return result

# ì‚¬ìš© ì˜ˆì‹œ
result = await request_stock_analysis("AAPL", "comprehensive")
print(f"AAPL ë¶„ì„ ê²°ê³¼: {result}")
```

### 2. ë¦¬ìŠ¤í¬ ë¶„ì„ ìš”ì²­

```python
async def request_risk_analysis(ticker: str):
    """ë¦¬ìŠ¤í¬ ë¶„ì„ ìš”ì²­"""
    
    message = {
        "message_id": f"msg_{int(time.time())}",
        "sender_id": "your_agent_id",
        "receiver_id": "risk_agent_001",
        "message_type": "request",
        "priority": "high",
        "timestamp": datetime.now().isoformat(),
        "payload": {
            "ticker": ticker,
            "event_sources": ["news", "financial_reports", "market_data"],
            "time_horizon": "1d",  # "1h", "1d", "1w", "1m"
            "severity_threshold": "medium"
        }
    }
    
    async with websockets.connect("ws://localhost:8767") as websocket:
        await websocket.send(json.dumps(message))
        response = await websocket.recv()
        return json.loads(response)

# ì‚¬ìš© ì˜ˆì‹œ
risk_result = await request_risk_analysis("TSLA")
print(f"TSLA ë¦¬ìŠ¤í¬ ë¶„ì„: {risk_result}")
```

### 3. í¬íŠ¸í´ë¦¬ì˜¤ ë¶„ì„ ìš”ì²­

```python
async def request_portfolio_analysis(user_id: str, portfolio_data: dict):
    """í¬íŠ¸í´ë¦¬ì˜¤ ë¶„ì„ ìš”ì²­"""
    
    message = {
        "message_id": f"msg_{int(time.time())}",
        "sender_id": "your_agent_id",
        "receiver_id": "portfolio_agent_001",
        "message_type": "request",
        "priority": "high",
        "timestamp": datetime.now().isoformat(),
        "payload": {
            "user_id": user_id,
            "portfolio_data": portfolio_data,
            "analysis_goals": ["risk_assessment", "optimization", "rebalancing"]
        }
    }
    
    async with websockets.connect("ws://localhost:8768") as websocket:
        await websocket.send(json.dumps(message))
        response = await websocket.recv()
        return json.loads(response)

# ì‚¬ìš© ì˜ˆì‹œ
portfolio_data = {
    "positions": [
        {"ticker": "AAPL", "quantity": 100, "average_price": 150.0},
        {"ticker": "GOOGL", "quantity": 50, "average_price": 2500.0}
    ],
    "cash": 10000.0
}

portfolio_result = await request_portfolio_analysis("user123", portfolio_data)
print(f"í¬íŠ¸í´ë¦¬ì˜¤ ë¶„ì„: {portfolio_result}")
```

## ğŸ“Š ì‘ë‹µ í˜•ì‹

### ì£¼ì‹ ë¶„ì„ ì‘ë‹µ

```json
{
  "message_type": "response",
  "correlation_id": "msg_1703123456_001",
  "payload": {
    "ticker": "AAPL",
    "current_price": 193.50,
    "overall_score": 75.5,
    "risk_score": 25.0,
    "momentum_score": 80.0,
    "trend_score": 70.0,
    "recommendations": [
      {
        "action": "BUY",
        "confidence": 0.85,
        "reasoning": "ê°•í•œ ëª¨ë©˜í…€ê³¼ ê¸ì •ì  ì¶”ì„¸",
        "target_price": 210.0,
        "stop_loss": 180.0
      }
    ],
    "analysis_type": "comprehensive",
    "timestamp": "2024-12-21T10:30:00Z"
  }
}
```

### ë¦¬ìŠ¤í¬ ë¶„ì„ ì‘ë‹µ

```json
{
  "message_type": "response",
  "correlation_id": "msg_1703123456_002",
  "payload": {
    "ticker": "AAPL",
    "overall_risk_score": 24.0,
    "risk_level": "low",
    "total_events": 4,
    "high_risk_events": 0,
    "risk_factors": ["market_volatility"],
    "recommendations": [
      "ë‚®ì€ ë¦¬ìŠ¤í¬ ìƒíƒœì…ë‹ˆë‹¤. ìƒëŒ€ì ìœ¼ë¡œ ì•ˆì „í•œ íˆ¬ì í™˜ê²½ì…ë‹ˆë‹¤."
    ],
    "recent_events": [
      {
        "title": "AAPL ì‹¤ì  ë°œí‘œ, ì˜ˆìƒë³´ë‹¤ ë‚®ì€ ë§¤ì¶œ",
        "event_type": "market",
        "severity": "medium",
        "risk_score": 25,
        "source": "Financial News",
        "published_date": "2024-12-20T10:00:00Z"
      }
    ],
    "confidence_score": 0.8,
    "timestamp": "2024-12-21T10:30:00Z"
  }
}
```

### í¬íŠ¸í´ë¦¬ì˜¤ ë¶„ì„ ì‘ë‹µ

```json
{
  "message_type": "response",
  "correlation_id": "msg_1703123456_003",
  "payload": {
    "user_id": "user123",
    "overall_score": 68.5,
    "risk_metrics": {
      "portfolio_volatility": 0.25,
      "max_drawdown": 0.15,
      "sharpe_ratio": 1.2,
      "beta": 1.1
    },
    "performance_metrics": {
      "total_return": 12.5,
      "annualized_return": 15.2,
      "win_rate": 0.65
    },
    "recommendations": [
      {
        "action": "REBALANCE",
        "reasoning": "ì„¹í„° ì§‘ì¤‘ë„ê°€ ë†’ìŒ",
        "confidence": 0.7
      }
    ],
    "sector_allocation": {
      "Technology": 60.0,
      "Healthcare": 25.0,
      "Finance": 15.0
    },
    "timestamp": "2024-12-21T10:30:00Z"
  }
}
```

## ğŸ”— HTTP API ëŒ€ì•ˆ

WebSocket ëŒ€ì‹  HTTP APIë¥¼ ì‚¬ìš©í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤:

### ì£¼ì‹ ë¶„ì„ HTTP ìš”ì²­

```python
import httpx

async def http_stock_analysis(ticker: str):
    """HTTP APIë¥¼ í†µí•œ ì£¼ì‹ ë¶„ì„"""
    
    async with httpx.AsyncClient() as client:
        response = await client.post(
            "http://localhost:8000/a2a/stock_analysis",
            json={
                "ticker": ticker,
                "analysis_type": "comprehensive",
                "timeframe": "1m",
                "user_profile": {
                    "risk_tolerance": "moderate",
                    "investment_horizon": "short_term"
                }
            },
            timeout=30.0
        )
        return response.json()

# ì‚¬ìš© ì˜ˆì‹œ
result = await http_stock_analysis("AAPL")
```

### ë¦¬ìŠ¤í¬ ë¶„ì„ HTTP ìš”ì²­

```python
async def http_risk_analysis(ticker: str):
    """HTTP APIë¥¼ í†µí•œ ë¦¬ìŠ¤í¬ ë¶„ì„"""
    
    async with httpx.AsyncClient() as client:
        response = await client.post(
            "http://localhost:8000/a2a/risk_analysis",
            json={
                "ticker": ticker,
                "event_sources": ["news", "financial_reports"],
                "time_horizon": "1d"
            },
            timeout=30.0
        )
        return response.json()
```

## ğŸ”§ ì„œë²„ ì‹œì‘ ë°©ë²•

### 1. A2A ì„œë²„ ì‹œì‘

```bash
# A2A í†µí•© ì„œë²„ ì‹œì‘
cd /path/to/mcp-yfinance-agent/src
python3 a2a_integration.py

# ë˜ëŠ” ê°œë³„ ì—ì´ì „íŠ¸ ì„œë²„ ì‹œì‘
python3 a2a_adapter.py --type investment --port 8766
python3 a2a_adapter.py --type risk --port 8767  
python3 a2a_adapter.py --type portfolio --port 8768
```

## ğŸ“‹ ì—ëŸ¬ ì²˜ë¦¬

### ì¼ë°˜ì ì¸ ì—ëŸ¬ ì½”ë“œ

| ì—ëŸ¬ ì½”ë“œ | ì„¤ëª… | í•´ê²° ë°©ë²• |
|-----------|------|-----------|
| `CONNECTION_FAILED` | ì—°ê²° ì‹¤íŒ¨ | ì„œë²„ ìƒíƒœ í™•ì¸, ì—”ë“œí¬ì¸íŠ¸ í™•ì¸ |
| `TIMEOUT` | ìš”ì²­ ì‹œê°„ ì´ˆê³¼ | ìš”ì²­ íƒ€ì„ì•„ì›ƒ ì¦ê°€, ì„œë²„ ë¶€í•˜ í™•ì¸ |
| `INVALID_MESSAGE` | ì˜ëª»ëœ ë©”ì‹œì§€ í˜•ì‹ | ë©”ì‹œì§€ êµ¬ì¡° ê²€ì¦ |
| `AGENT_NOT_FOUND` | ì—ì´ì „íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ | ì—ì´ì „íŠ¸ ID í™•ì¸ |
| `ANALYSIS_FAILED` | ë¶„ì„ ì‹¤íŒ¨ | ìš”ì²­ íŒŒë¼ë¯¸í„° í™•ì¸ |

### ì—ëŸ¬ ì‘ë‹µ ì˜ˆì œ

```json
{
  "message_type": "error",
  "correlation_id": "msg_1703123456_001",
  "payload": {
    "error_code": "ANALYSIS_FAILED",
    "error_message": "ì¢…ëª© ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤",
    "original_request": {
      "ticker": "INVALID_TICKER",
      "analysis_type": "comprehensive"
    }
  }
}
```
